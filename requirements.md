# 要件定義書

## プロジェクト名
gemini-cost-tracker

## 概要
Google CloudのGemini APIとVertex AIで使用したトークン数とコストを表示するCLIツール

## 目的
- Gemini/Vertex AIの利用状況を簡単に確認できるようにする
- APIの利用コストを可視化し、予算管理を支援する
- 開発者が素早く利用状況を把握できるツールを提供する

## 機能要件

### 必須機能
1. **トークン使用量の表示**
   - Gemini APIのトークン使用量を取得・表示
   - Vertex AIのトークン使用量を取得・表示
   - 入力トークンと出力トークンを分けて表示

2. **コスト計算・表示**
   - 現在の料金体系に基づいたコスト計算
   - 通貨単位の選択（USD/JPY）
   - 小数点以下の適切な桁数での表示

3. **期間指定**
   - 今日の使用量
   - 過去7日間の使用量
   - 過去30日間の使用量
   - カスタム期間の指定

4. **実行方法**
   - `npx gemini-cost-tracker@latest`で実行可能
   - `npm install -g gemini-cost-tracker`でグローバルインストール可能

### オプション機能
1. **フィルタリング**
   - プロジェクト別の表示
   - モデル別の表示（例: gemini-pro, gemini-pro-vision）
   - リージョン別の表示

2. **データエクスポート**
   - CSV形式でのエクスポート
   - JSON形式でのエクスポート

3. **ビジュアライゼーション**
   - コンソール上でのグラフ表示
   - トレンドの可視化

## 非機能要件

### パフォーマンス
- API呼び出しから結果表示まで5秒以内
- 大量のデータでも適切にページネーション

### セキュリティ
- APIキーの安全な管理
- 環境変数での認証情報管理
- 認証情報のマスキング表示

### ユーザビリティ
- 直感的なコマンドライン引数
- わかりやすいヘルプメッセージ
- エラーメッセージの適切な表示
- プログレスバーによる進捗表示

### 互換性
- Node.js 16.x以上のサポート
- Windows/Mac/Linux対応
- ターミナルの幅に応じた表示調整

## 技術要件

### 開発言語・フレームワーク
- TypeScript 5.x
- Node.js 16.x以上

### 主要ライブラリ
- Commander.js（CLIフレームワーク）
- Chalk（カラー出力）
- Table（テーブル表示）
- Inquirer（対話型プロンプト）
- Axios/Fetch（API通信）
- dotenv（環境変数管理）

### API
- Google Cloud Billing API
- Vertex AI API
- Gemini API

## 制約事項
1. Google Cloudの認証が必要
2. APIの利用制限に従う
3. リアルタイムデータではなく、APIが提供する最新データを使用

## 成功指標
1. コマンド実行から5秒以内に結果表示
2. 正確なコスト計算（誤差1%以内）
3. 月間アクティブユーザー100人以上（公開後）

## リリース計画
1. v0.1.0 - 基本機能（トークン表示、コスト計算）
2. v0.2.0 - 期間指定、フィルタリング機能
3. v0.3.0 - エクスポート機能
4. v1.0.0 - 正式リリース（全機能実装）

## 運用要件
- npm registryへの公開
- GitHub上でのソースコード管理
- セマンティックバージョニングの採用
- 定期的なセキュリティアップデート