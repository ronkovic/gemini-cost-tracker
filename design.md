# è¨­è¨ˆæ›¸

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

> **æ³¨æ„**: ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯2025å¹´7æœˆã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã«ã‚ˆã‚Šå¤§å¹…ã«æ›´æ–°ã•ã‚Œã¾ã—ãŸã€‚

## ğŸ”„ ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®ä¸»ãªæ”¹å–„ç‚¹

### 1. å‹å®‰å…¨æ€§ã®å‘ä¸Š
- **ErrorCodeåˆ—æŒ™å‹**: 26ç¨®é¡ã®ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã§ä¸€è²«ã—ãŸã‚¨ãƒ©ãƒ¼ç®¡ç†
- **å‹ã‚¨ã‚¤ãƒªã‚¢ã‚¹**: `Period`, `Format`, `Currency`, `Service`ã§å‹å®‰å…¨æ€§å‘ä¸Š
- **å³å¯†ãªå‹ãƒã‚§ãƒƒã‚¯**: unknownå‹ã®æ¸›å°‘ã¨é©åˆ‡ãªå‹ã‚­ãƒ£ã‚¹ãƒˆ

### 2. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®çµ±ä¸€
- **ErrorHandlerã‚¯ãƒ©ã‚¹**: é›†ç´„ã‚¨ãƒ©ãƒ¼å‡¦ç†ã¨ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰
- **withErrorHandling**: éåŒæœŸé–¢æ•°ç”¨ã‚¨ãƒ©ãƒ¼ãƒ©ãƒƒãƒ”ãƒ³ã‚°
- **ä¸€è²«ã—ãŸã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: ã‚³ãƒ¼ãƒ‰ä»˜ãã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

### 3. æ§‹é€ åŒ–ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ 
- **JSON/ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼**: ç’°å¢ƒå¤‰æ•°ã§åˆ‡ã‚Šæ›¿ãˆå¯èƒ½
- **ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå¯¾å¿œ**: ãƒ­ã‚°ã«é–¢é€£æƒ…å ±ã‚’å«ã‚ã‚‹
- **ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«åˆ¶å¾¡**: ERROR, WARN, INFO, DEBUGã®4æ®µéš

### 4. è¨­å®šç®¡ç†ã®æ”¹å–„
- **ConfigManager**: ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ã®è¨­å®šç®¡ç†
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ç®¡ç†**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ãƒ™ãƒ«ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š
- **ç’°å¢ƒå¤‰æ•°ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¨ç’°å¢ƒå¤‰æ•°ã®çµ±åˆ

### 5. å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- **ValidationUtils**: åŒ…æ‹¬çš„ãªå…¥åŠ›æ¤œè¨¼ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
- **å‹ã‚¬ãƒ¼ãƒ‰é–¢æ•°**: TypeScriptã®å‹ã‚·ã‚¹ãƒ†ãƒ ã¨é€£æº
- **æ—©æœŸãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œå‰ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¤œè¨¼

### ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CLI Entry     â”‚
â”‚  (index.ts)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Command Parser  â”‚
â”‚ (commander.js)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Core Services  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Auth Manager  â”‚
â”‚ â€¢ API Client    â”‚
â”‚ â€¢ Cost Calc     â”‚
â”‚ â€¢ Data Format   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  External APIs  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Gemini API    â”‚
â”‚ â€¢ Vertex AI     â”‚
â”‚ â€¢ Billing API   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ï¼ˆãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¾Œï¼‰
```
gemini-cost-tracker/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts              # CLIã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ commands/             # ã‚³ãƒãƒ³ãƒ‰å®Ÿè£…
â”‚   â”‚   â”œâ”€â”€ show.ts          # è¡¨ç¤ºã‚³ãƒãƒ³ãƒ‰
â”‚   â”‚   â”œâ”€â”€ export.ts        # ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒãƒ³ãƒ‰
â”‚   â”‚   â”œâ”€â”€ config.ts        # è¨­å®šã‚³ãƒãƒ³ãƒ‰
â”‚   â”‚   â”œâ”€â”€ test.ts          # æ¥ç¶šãƒ†ã‚¹ãƒˆã‚³ãƒãƒ³ãƒ‰
â”‚   â”‚   â””â”€â”€ updatePricing.ts # æ–™é‡‘æƒ…å ±æ›´æ–°ã‚³ãƒãƒ³ãƒ‰
â”‚   â”œâ”€â”€ services/            # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ auth/            # èªè¨¼é–¢é€£
â”‚   â”‚   â”‚   â””â”€â”€ authManager.ts   # èªè¨¼ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ config/          # è¨­å®šç®¡ç† â† æ–°è¨­ï¼
â”‚   â”‚   â”‚   â””â”€â”€ configManager.ts # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ api/             # APIé€šä¿¡
â”‚   â”‚   â”‚   â”œâ”€â”€ geminiClient.ts  # Gemini APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ vertexClient.ts  # Vertex AIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â”‚   â””â”€â”€ realUsageClient.ts # å®Ÿéš›APIä½¿ç”¨ãƒ‡ãƒ¼ã‚¿å–å¾—
â”‚   â”‚   â”‚   â”œâ”€â”€ calculator/      # ã‚³ã‚¹ãƒˆè¨ˆç®—
â”‚   â”‚   â”‚   â”œâ”€â”€ costCalculator.ts # ã‚³ã‚¹ãƒˆè¨ˆç®—ã‚¨ãƒ³ã‚¸ãƒ³
â”‚   â”‚   â”‚   â”œâ”€â”€ priceTable.ts     # æ–™é‡‘ãƒ†ãƒ¼ãƒ–ãƒ«
â”‚   â”‚   â”‚   â””â”€â”€ priceUpdater.ts   # æ–™é‡‘æƒ…å ±æ›´æ–°
â”‚   â”‚   â””â”€â”€ formatter/       # ãƒ‡ãƒ¼ã‚¿æ•´å½¢
â”‚   â”‚       â”œâ”€â”€ tableFormatter.ts
â”‚   â”‚       â”œâ”€â”€ csvFormatter.ts
â”‚   â”‚       â”œâ”€â”€ jsonFormatter.ts
â”‚   â”‚       â””â”€â”€ chartFormatter.ts # ã‚°ãƒ©ãƒ•è¡¨ç¤º
â”‚   â”œâ”€â”€ utils/               # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ â† å¤§å¹…å¼·åŒ–ï¼
â”‚   â”‚   â”œâ”€â”€ constants.ts     # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å®šæ•° â† æ–°è¨­ï¼
â”‚   â”‚   â”œâ”€â”€ errorHandler.ts  # é›†ç´„ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° â† æ–°è¨­ï¼
â”‚   â”‚   â”œâ”€â”€ logger.ts        # æ§‹é€ åŒ–ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ  â† å¼·åŒ–ï¼
â”‚   â”‚   â”œâ”€â”€ validation.ts    # å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ â† æ–°è¨­ï¼
â”‚   â”‚   â”œâ”€â”€ dateHelper.ts    # æ—¥ä»˜ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”‚   â””â”€â”€ validator.ts     # æ—¢å­˜ãƒãƒªãƒ‡ãƒ¼ã‚¿ï¼ˆäº’æ›æ€§ã®ãŸã‚ä¿æŒï¼‰
â”‚   â””â”€â”€ types/               # TypeScriptå‹å®šç¾© â† å¤§å¹…å¼·åŒ–ï¼
â”‚       â””â”€â”€ index.ts         # å‹ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã€ErrorCodeåˆ—æŒ™å‹ã€çµ±åˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”œâ”€â”€ tests/                   # ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ integration/
â”‚   â””â”€â”€ fixtures/
â”œâ”€â”€ bin/                     # å®Ÿè¡Œå¯èƒ½ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â””â”€â”€ gemini-cost-tracker
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ .eslintrc.js
â”œâ”€â”€ .prettierrc
â”œâ”€â”€ README.md
â”œâ”€â”€ tasks.md
â”œâ”€â”€ requirements.md
â””â”€â”€ design.md
```

## ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

### 1. CLI Entry Point (index.ts)
```typescript
// ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¾Œã®å‹å®šç¾©
type Period = 'today' | 'week' | 'month' | 'custom';
type Format = 'table' | 'json' | 'csv' | 'chart';
type Currency = 'USD' | 'JPY';
type Service = 'gemini' | 'vertex-ai';

interface CLIOptions {
  period?: Period;
  startDate?: string;
  endDate?: string;
  project?: string;
  model?: string;
  format?: Format;
  output?: string;
  currency?: Currency;
  realData?: boolean; // æ–°è¿½åŠ ï¼
}
```

## ğŸ”„ ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¾Œã®æ–°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### 1. ErrorHandler (é›†ç´„ã‚¨ãƒ©ãƒ¼ç®¡ç†)
```typescript
enum ErrorCode {
  INVALID_CONFIG = 'INVALID_CONFIG',
  API_ERROR = 'API_ERROR',
  AUTH_ERROR = 'AUTH_ERROR',
  NETWORK_ERROR = 'NETWORK_ERROR',
  FILE_ERROR = 'FILE_ERROR',
  VALIDATION_ERROR = 'VALIDATION_ERROR',
  // ... 26ç¨®é¡ã®ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰
}

class ErrorHandler {
  static handle(error: unknown, context?: Record<string, unknown>): AppError;
  static createValidationError(message: string, details?: unknown): AppError;
  static createAuthError(message?: string, details?: unknown): AppError;
  static createNetworkError(message?: string, details?: unknown): AppError;
}

// ãƒ©ãƒƒãƒ‘ãƒ¼é–¢æ•°
function withErrorHandling<T>(
  fn: (...args: any[]) => Promise<T>,
  context?: Record<string, unknown>
): (...args: any[]) => Promise<T>;
```

### 2. ConfigManager (è¨­å®šç®¡ç†)
```typescript
interface ConfigFile {
  defaultProject?: string;
  defaultCurrency?: Currency;
  defaultFormat?: Format;
  apiKeys?: {
    gemini?: string;
    vertexAI?: string;
  };
  gcpSettings?: {
    projectId?: string;
    keyFilePath?: string;
  };
}

class ConfigManager {
  async loadConfig(): Promise<ConfigFile>;
  async saveConfig(config: ConfigFile): Promise<void>;
  async updateConfig(updates: Partial<ConfigFile>): Promise<ConfigFile>;
  
  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ç®¡ç†
  async getDefaultCurrency(): Promise<Currency>;
  async setDefaultCurrency(currency: Currency): Promise<void>;
  async getDefaultFormat(): Promise<Format>;
  async setDefaultFormat(format: Format): Promise<void>;
  
  // èªè¨¼æƒ…å ±ç®¡ç†
  async getGeminiApiKey(): Promise<string | undefined>;
  async setGeminiApiKey(apiKey: string): Promise<void>;
  async getGcpProjectId(): Promise<string | undefined>;
  async setGcpProjectId(projectId: string): Promise<void>;
}
```

### 3. Logger (æ§‹é€ åŒ–ãƒ­ã‚°)
```typescript
enum LogLevel {
  ERROR = 0,
  WARN = 1,
  INFO = 2,
  DEBUG = 3,
}

interface LogEntry {
  level: LogLevel;
  message: string;
  timestamp: Date;
  context?: Record<string, unknown>;
  error?: Error;
}

class Logger {
  setLevel(level: LogLevel): void;
  setFormat(format: 'json' | 'text'): void;
  
  error(message: string, context?: Record<string, unknown>, error?: Error): void;
  warn(message: string, context?: Record<string, unknown>): void;
  info(message: string, context?: Record<string, unknown>): void;
  debug(message: string, context?: Record<string, unknown>): void;
  
  // ã‚¢ãƒ—ãƒªã‚¨ãƒ©ãƒ¼ç”¨
  appError(message: string, code: ErrorCode, error?: Error, context?: Record<string, unknown>): void;
}
```

### 4. ValidationUtils (å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³)
```typescript
class ValidationUtils {
  // å‹ã‚¬ãƒ¼ãƒ‰é–¢æ•°
  static isValidPeriod(period: string): period is Period;
  static isValidFormat(format: string): format is Format;
  static isValidCurrency(currency: string): currency is Currency;
  static isValidModel(model: string): boolean;
  
  // æ¤œè¨¼é–¢æ•°
  static validateDateRange(startDate: string, endDate: string): void;
  static validateGcpProjectId(projectId: string): void;
  static validateApiKey(apiKey: string): void;
  static validateCliOptions(options: CLIOptions): void;
  
  // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
  static sanitizeInput(input: string): string;
  static isValidEmail(email: string): boolean;
  static isValidUrl(url: string): boolean;
}
```

### 2. Authentication Manager
```typescript
interface AuthCredentials {
  geminiApiKey?: string;
  gcpProjectId?: string;
  gcpKeyFile?: string;
}

class AuthManager {
  // è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜å ´æ‰€ï¼ˆXDG Base Directoryæº–æ‹ ï¼‰
  // - macOS/Linux: ~/.config/gemini-cost-tracker/config.json
  // - XDG_CONFIG_HOMEè¨­å®šæ™‚: $XDG_CONFIG_HOME/gemini-cost-tracker/config.json
  // - Windows: %APPDATA%\gemini-cost-tracker\config.json
  
  async initialize(): Promise<void>;
  async getGeminiCredentials(): Promise<string>;
  async getVertexCredentials(): Promise<GoogleAuth>;
  async validateCredentials(): Promise<boolean>;
  
  // è¨­å®šå€¤ã®å€‹åˆ¥æ›´æ–°ï¼ˆæ—¢å­˜å€¤ã‚’ä¿æŒï¼‰
  async setGeminiApiKey(apiKey: string): Promise<void>;
  async setGcpProjectId(projectId: string): Promise<void>;
  async setGcpKeyFile(keyFile: string): Promise<void>;
}
```

### 3. API Clients
```typescript
interface UsageData {
  date: Date;
  inputTokens: number;
  outputTokens: number;
  model: string;
  project?: string;
}

interface APIClient {
  async getUsage(params: UsageParams): Promise<UsageData[]>;
}

class GeminiClient implements APIClient {
  // Gemini APIå®Ÿè£…
}

class VertexClient implements APIClient {
  // Vertex AI APIå®Ÿè£…
}
```

### 4. Cost Calculator
```typescript
interface PriceModel {
  inputTokenPrice: number;
  outputTokenPrice: number;
  currency: 'USD' | 'JPY';
  model: string;
}

class CostCalculator {
  calculateCost(usage: UsageData, priceModel: PriceModel): Cost;
  convertCurrency(amount: number, from: string, to: string): number;
}
```

### 5. Data Formatters
```typescript
interface Formatter {
  format(data: CostReport): string;
}

class TableFormatter implements Formatter {
  // ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º
  // Usage Details ã¯é™é †è¡¨ç¤ºï¼ˆæœ€æ–°ãŒä¸Šï¼‰
  // v0.1.2ä»¥é™: sortedDetails = [...data.details].sort((a, b) => b.date.getTime() - a.date.getTime())
}

class CSVFormatter implements Formatter {
  // CSVå½¢å¼å‡ºåŠ›
}

class JSONFormatter implements Formatter {
  // JSONå½¢å¼å‡ºåŠ›
}
```

## ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### Usage Model
```typescript
interface Usage {
  id: string;
  timestamp: Date;
  service: 'gemini' | 'vertex-ai';
  model: string;
  inputTokens: number;
  outputTokens: number;
  project?: string;
  region?: string;
}
```

### Cost Model
```typescript
interface Cost {
  usageId: string;
  inputCost: number;
  outputCost: number;
  totalCost: number;
  currency: string;
  calculatedAt: Date;
}
```

### Report Model
```typescript
interface CostReport {
  period: {
    start: Date;
    end: Date;
  };
  summary: {
    totalInputTokens: number;
    totalOutputTokens: number;
    totalCost: number;
    currency: string;
  };
  details: Array<{
    date: Date;
    service: string;
    model: string;
    usage: Usage;
    cost: Cost;
  }>;
}
```

## APIè¨­è¨ˆ

### Gemini API Integration
- ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: `https://generativelanguage.googleapis.com/v1/`
- èªè¨¼: APIã‚­ãƒ¼
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™å¯¾å¿œ: exponential backoff

### Vertex AI Integration
- ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: ãƒªãƒ¼ã‚¸ãƒ§ãƒ³åˆ¥
- èªè¨¼: ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ or ADC
- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œ

### Billing API Integration
- Cloud Billing API v1
- ã‚³ã‚¹ãƒˆæƒ…å ±ã®å–å¾—
- äºˆç®—ã‚¢ãƒ©ãƒ¼ãƒˆæƒ…å ±

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥
1. **èªè¨¼ã‚¨ãƒ©ãƒ¼**
   - APIã‚­ãƒ¼ç„¡åŠ¹
   - æ¨©é™ä¸è¶³
   - èªè¨¼æƒ…å ±æœªè¨­å®š

2. **APIé€šä¿¡ã‚¨ãƒ©ãƒ¼**
   - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼
   - ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
   - ãƒ¬ãƒ¼ãƒˆåˆ¶é™

3. **ãƒ‡ãƒ¼ã‚¿ã‚¨ãƒ©ãƒ¼**
   - ä¸æ­£ãªãƒ‡ãƒ¼ã‚¿å½¢å¼
   - æœŸé–“æŒ‡å®šã‚¨ãƒ©ãƒ¼
   - ãƒ‡ãƒ¼ã‚¿ä¸è¶³

### ã‚¨ãƒ©ãƒ¼å‡¦ç†ãƒ•ãƒ­ãƒ¼
```typescript
class AppError extends Error {
  constructor(
    public code: string,
    public message: string,
    public details?: any
  ) {
    super(message);
  }
}

// ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
function handleError(error: AppError): void {
  logger.error(error);
  
  switch (error.code) {
    case 'AUTH_ERROR':
      console.error('èªè¨¼ã‚¨ãƒ©ãƒ¼:', error.message);
      console.log('èªè¨¼æƒ…å ±ã‚’ç¢ºèªã—ã¦ãã ã•ã„');
      break;
    case 'API_ERROR':
      console.error('APIé€šä¿¡ã‚¨ãƒ©ãƒ¼:', error.message);
      break;
    default:
      console.error('ã‚¨ãƒ©ãƒ¼:', error.message);
  }
  
  process.exit(1);
}
```

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

### èªè¨¼æƒ…å ±ã®ç®¡ç†
1. ç’°å¢ƒå¤‰æ•°ã§ã®ç®¡ç†
2. dotenvãƒ•ã‚¡ã‚¤ãƒ«ã®ä½¿ç”¨ï¼ˆ.gitignoreå¿…é ˆï¼‰
3. ã‚­ãƒ¼ãƒã‚§ãƒ¼ãƒ³ã¸ã®ä¿å­˜ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

### APIã‚­ãƒ¼ã®ä¿è­·
```typescript
// ãƒã‚¹ã‚­ãƒ³ã‚°è¡¨ç¤º
function maskApiKey(key: string): string {
  if (key.length < 8) return '***';
  return key.substring(0, 4) + '...' + key.substring(key.length - 4);
}
```

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æˆ¦ç•¥
1. APIçµæœã®ä¸€æ™‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆTTL: 5åˆ†ï¼‰
2. æ–™é‡‘è¡¨ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥
3. èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥

### ä¸¦åˆ—å‡¦ç†
```typescript
// è¤‡æ•°APIã®ä¸¦åˆ—å‘¼ã³å‡ºã—
async function fetchAllUsage(params: UsageParams): Promise<UsageData[]> {
  const [geminiData, vertexData] = await Promise.all([
    geminiClient.getUsage(params),
    vertexClient.getUsage(params)
  ]);
  
  return [...geminiData, ...vertexData];
}
```

## ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### å˜ä½“ãƒ†ã‚¹ãƒˆ
- å„ã‚µãƒ¼ãƒ“ã‚¹ã‚¯ãƒ©ã‚¹ã®ãƒ†ã‚¹ãƒˆ
- ã‚³ã‚¹ãƒˆè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ
- ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ã®ãƒ†ã‚¹ãƒˆ

### çµ±åˆãƒ†ã‚¹ãƒˆ
- CLI ã‚³ãƒãƒ³ãƒ‰ã®E2Eãƒ†ã‚¹ãƒˆ
- APIãƒ¢ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ãŸçµ±åˆãƒ†ã‚¹ãƒˆ

### ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™
- å˜ä½“ãƒ†ã‚¹ãƒˆ: 80%ä»¥ä¸Š
- çµ±åˆãƒ†ã‚¹ãƒˆ: ä¸»è¦ã‚·ãƒŠãƒªã‚ª100%

## CI/CDè¨­è¨ˆ

### GitHub Actions
```yaml
name: CI/CD Pipeline
on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  test:
    # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
  build:
    # ãƒ“ãƒ«ãƒ‰
  publish:
    # npm publish (ã‚¿ã‚°ãƒ—ãƒƒã‚·ãƒ¥æ™‚)
```

## ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°æˆ¦ç•¥
- ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°æ¡ç”¨
- Breaking changes: ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³
- æ–°æ©Ÿèƒ½: ãƒã‚¤ãƒŠãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³
- ãƒã‚°ä¿®æ­£: ãƒ‘ãƒƒãƒãƒãƒ¼ã‚¸ãƒ§ãƒ³